# Asciinema-Rails

Converts sudosh log files to asciinema format.

## Installation

Add this line to your application's Gemfile:

```ruby
gem 'asciinema-rails'
```

And then execute:

    $ bundle install

Or install it manually:

    $ gem install asciinema-rails

## Prerequisites

Use of this gem depends on the binary `terminal` which must be compiled for your platform before using the gem. There is a source file `terminal.c` located in the `/src` directory of the gem. Before compiling, you will need to install the `libtsm` library on your platform. For Darwin based systems (OSX), a reliable source for libtsm is 
https://github.com/skade/libtsm.

Once `libtsm` has been installed, compile `terminal.c`:

    $ gcc -O3 -o terminal terminal.c -ltsm

The resulting binary file `terminal` should be placed in `/usr/bin` or similar, or added to the $PATH.


## Usage

Asciinema-rails consists of two parts - a Convertor module for creatiing Asciinema player files, and an engine that allows you to playback the files from your own site.

### Asciinema::Rails::Convertor

Asciinema::Rails::Convertor has two methods, one to generate player files from Asciinema recording files (JSON), and another to covert Sudosh log files to the Asciinema recording format (which can then be used to create player files.)



    Asciinema::Rails::Convertor.to_infile(sudosh_timing_file_location, sudosh_script_file_location)

returns a JSON string in the correct format for upload to asciinema.org.

### Rails Engine

To display a player from your app, you need to include the asciineama-rails javascript and stylesheet files in ```app/assets/javascripts/application.js```and ```app/assets/stylesheets/application.css respectively```:

##### application.js
    //= require asciinema-rails

##### application.css
    *= require asciinema-rails
 
Then include the player markup and javascript in any of your views:

    <div id='player-container'></div> <!-- the div that will contain the player -->

    <%= javascript_tag do %>
      $(function() {
        function createPlayer() {
          var source = new asciinema.HttpArraySource("recording.json", 1);
          var snapshot = []
          var movie = new asciinema.Movie(180, 43, source, snapshot, 9);

          React.renderComponent(
            asciinema.Player({ autoPlay: true, movie: movie }),
            $('#player-container')[0]
          );
        }
        createPlayer();
      });
    <% end %>

In this case, the Asciinema player file `recording.json` has been placed in the public directory of the app. This can be replaced with a fully qualified url, as long as it points to a player file.

The parameters sent to the asciinema.Movie constructor are the terminal width (cols), height (rows), playback file source, snapshot and playback speed. 

The width, height and snapshot string are returned form the Asciinema::Rails::Convertor.to_outfile method. Typically, player files would be associated with a Rails model, and this information would be saved as model fields when the playback files are generated.

## 


Create a new rails application.
Follow the steps above under Installation.
Create an Asciinema player file:
a) From the output file of the Asciinema binary:

Asciinema::Rails::Convertor.to_outfile('/Users/eddiej/Rails/asciinemosh/recording', {outfile_location: '/tmp/recording.json'})

b) From a pair of Sudosh log files:

Include the asciienmosh assets:
in app/assets/javascripts/application.js - 

//= require asciinema-rails

in app/assets/stylesheets/applications.css

*= require asciinema-rails


// include player markup and javascript in any of your views:

```html
<div id='player-container'></div>

<%= javascript_tag do %>
  $(function() {
    function createPlayer() {
      var source = new asciinema.HttpArraySource("recording.json", 1);
      var snapshot = []
      var movie = new asciinema.Movie(180, 43, source, snapshot, 9);

      React.renderComponent(
        asciinema.Player({ autoPlay: true, movie: movie }),
        $('#player-container')[0]
      );
    }
    createPlayer();
  });
<% end %>
```

When a player file is generated by the gem by calling .asdsd
a static snapshot string is returned. This can be saved in a model field for instance, and used to show a preview of the video playback.



## Testing

    bundle exec rspec spec

## Contributing

1. Fork it ( https://github.com/[my-github-username]/asciinemosh/fork )
2. Create your feature branch (`git checkout -b my-new-feature`)
3. Commit your changes (`git commit -am 'Add some feature'`)
4. Push to the branch (`git push origin my-new-feature`)
5. Create a new Pull Request
